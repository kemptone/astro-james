---
export const prerender = false
---

<pr8-dialog>
  <dialog class="dialog">
    <div class="dialog-content">
      <header class="dialog-header">
        <slot name="header"></slot>
        <button class="dialog-close" aria-label="Close dialog">Ã—</button>
      </header>
      <div class="dialog-body">
        <slot></slot>
      </div>
    </div>
  </dialog>
</pr8-dialog>

<script>
  class DialogComponent extends HTMLElement {
    private e_dialog: HTMLDialogElement | null = null
    private e_closeButton: HTMLButtonElement | null = null

    constructor() {
      super()
      this.setupElementReferences()
      this.attachEventListeners()
    }

    private setupElementReferences() {
      this.e_dialog = this.querySelector('dialog')
      this.e_closeButton = this.querySelector('.dialog-close')
    }

    private attachEventListeners() {
      this.e_closeButton?.addEventListener('click', () => this.close())
      
      // Close on backdrop click
      this.e_dialog?.addEventListener('click', (e) => {
        if (e.target === this.e_dialog) {
          this.close()
        }
      })
      
      // Close on escape key
      this.e_dialog?.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          this.close()
        }
      })
    }

    open() {
      if (this.e_dialog) {
        this.e_dialog.showModal()
        this.setAttribute('open', '')
      }
    }

    close() {
      if (this.e_dialog) {
        this.e_dialog.close()
        this.removeAttribute('open')
      }
    }

    toggle() {
      if (this.e_dialog?.open) {
        this.close()
      } else {
        this.open()
      }
    }
  }

  customElements.define('pr8-dialog', DialogComponent)
</script>

<style>
  pr8-dialog {
    display: contents;
  }

  .dialog {
    border: none;
    border-radius: 8px;
    padding: 0;
    max-width: 90vw;
    max-height: 90vh;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    background: transparent;
  }

  .dialog::backdrop {
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .dialog-content {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    min-width: 320px;
    max-width: 500px;
  }

  .dialog-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 20px 10px;
    border-bottom: 1px solid #eee;
    background: #f9f9f9;
  }

  .dialog-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .dialog-close:hover {
    color: #333;
    background: #e0e0e0;
  }

  .dialog-body {
    padding: 20px;
  }

  /* Animation for opening */
  @keyframes dialog-fade-in {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .dialog[open] {
    animation: dialog-fade-in 0.2s ease-out;
  }

  /* Responsive design */
  @media (max-width: 640px) {
    .dialog {
      max-width: 95vw;
      margin: 10px;
    }
    
    .dialog-content {
      min-width: auto;
    }
    
    .dialog-header {
      padding: 15px 15px 10px;
    }
    
    .dialog-body {
      padding: 15px;
    }
  }
</style>