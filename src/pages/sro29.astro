---
import Menu from '@/components/menu.astro'

// SRO29 - Environmental Data Game with Temperature, Air Quality, and Video Timeline
const title = 'SRO29 - Environmental Data'
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        text-align: center;
        color: #667eea;
        margin-bottom: 30px;
        font-size: 2.5em;
      }

      .city-input-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .input-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #555;
      }

      input[type='text'],
      input[type='number'] {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      input[type='text']:focus,
      input[type='number']:focus {
        outline: none;
        border-color: #667eea;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition:
          background 0.3s,
          transform 0.1s;
      }

      button:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }

      button:active {
        transform: translateY(0);
      }

      .reset-all-btn {
        background: #dc3545;
        margin-top: 20px;
      }

      .reset-all-btn:hover {
        background: #c82333;
      }

      .header-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .cities-display {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .city-card {
        background: white;
        border: 3px solid #ddd;
        border-radius: 12px;
        padding: 15px;
        transition:
          transform 0.3s,
          box-shadow 0.3s;
      }

      .city-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .city-name {
        font-size: 1.3em;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .temperature-bar {
        height: 30px;
        border-radius: 8px;
        margin: 10px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      .aqi-display {
        background: #f0f0f0;
        padding: 10px;
        border-radius: 8px;
        margin-top: 10px;
      }

      .aqi-bar-container {
        background: #e0e0e0;
        height: 25px;
        border-radius: 12px;
        overflow: hidden;
        margin-top: 5px;
        position: relative;
      }

      .aqi-bar {
        height: 100%;
        transition:
          width 0.5s ease,
          background-color 0.5s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: white;
        font-size: 12px;
      }

      .temperature-tracking {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 30px;
      }

      .temp-track-bar {
        background: linear-gradient(
          to right,
          #0000ff,
          #87ceeb,
          #00ffff,
          #808080,
          #ffff00,
          #ffa500,
          #ff0000,
          #8b0000
        );
        height: 50px;
        border-radius: 12px;
        position: relative;
        margin: 20px 0;
      }

      .temp-marker {
        position: absolute;
        width: 4px;
        height: 60px;
        background: black;
        top: -5px;
        transition: left 0.3s;
      }

      .temp-marker::after {
        content: attr(data-value);
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        background: black;
        color: white;
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 12px;
        white-space: nowrap;
      }

      .video-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
      }

      .video-timeline {
        background: #333;
        height: 60px;
        border-radius: 12px;
        position: relative;
        margin: 20px 0;
        overflow: hidden;
      }

      .video-progress {
        background: linear-gradient(to right, #667eea, #764ba2);
        height: 100%;
        width: 0%;
        transition: width 0.1s linear;
      }

      .video-time {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: 700;
        font-size: 1.2em;
      }

      .video-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
      }

      .section-title {
        font-size: 1.5em;
        color: #667eea;
        margin-bottom: 15px;
        font-weight: 700;
      }

      .color-legend {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-top: 15px;
        font-size: 0.9em;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .legend-color {
        width: 30px;
        height: 20px;
        border-radius: 4px;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <Menu />
    <div class="container">
      <div class="header-controls">
        <h1>üåç SRO29 - Environmental Data Game</h1>
        <button class="reset-all-btn" id="resetAllBtn">Reset All</button>
      </div>

      <div class="city-input-section">
        <h2 class="section-title">Add City</h2>
        <div class="input-group">
          <label for="cityName">City Name:</label>
          <input type="text" id="cityName" placeholder="Enter city name" />
        </div>
        <div class="input-group">
          <label for="temperature">Temperature (0-8, decimals allowed):</label>
          <input
            type="number"
            id="temperature"
            min="0"
            max="8"
            step="0.1"
            placeholder="0 = coldest, 8 = hottest"
          />
        </div>
        <div class="input-group">
          <label for="airQuality">Air Quality Index (1-500):</label>
          <input
            type="number"
            id="airQuality"
            min="1"
            max="500"
            placeholder="Enter AQI value"
          />
        </div>
        <button id="addCityBtn">Add City</button>

        <div class="color-legend">
          <div
            class="section-title"
            style="grid-column: 1/-1; margin-top: 20px;"
          >
            Temperature Scale:
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #000000;"></div><span
              >0 - Black</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #0000ff;"></div><span
              >1 - Blue</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #87ceeb;"></div><span
              >2 - Sky Blue</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #00ffff;"></div><span
              >3 - Aqua</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #808080;"></div><span
              >4 - Medium (Neutral)</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ffff00;"></div><span
              >5 - Yellow</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ffa500;"></div><span
              >6 - Orange</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ff0000;"></div><span
              >7 - Red</span
            >
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #8b0000;"></div><span
              >8 - Dark Red</span
            >
          </div>
        </div>
      </div>

      <div id="citiesDisplay" class="cities-display"></div>

      <div class="temperature-tracking">
        <h2 class="section-title">Temperature Tracking Over Days</h2>
        <div class="input-group">
          <label for="trackingValue">Tracking Position (0-100%):</label>
          <input
            type="number"
            id="trackingValue"
            min="0"
            max="100"
            value="0"
            placeholder="0 = far left, 100 = far right"
          />
        </div>
        <div class="temp-track-bar">
          <div class="temp-marker" id="tempMarker" data-value="0%"></div>
        </div>
      </div>

      <div class="video-section">
        <h2 class="section-title">Video Timeline</h2>
        <div class="input-group">
          <label for="videoDuration">Video Duration (seconds):</label>
          <input
            type="number"
            id="videoDuration"
            min="1"
            max="7200"
            value="60"
            placeholder="e.g., 7200 = 2 hours"
          />
        </div>
        <div class="video-timeline">
          <div class="video-progress" id="videoProgress"></div>
          <div class="video-time" id="videoTime">0:00 / 1:00</div>
        </div>
        <div class="video-controls">
          <button id="playBtn">Play</button>
          <button id="pauseBtn">Pause</button>
          <button id="resetBtn">Reset</button>
        </div>
      </div>
    </div>

    <script>
      // Temperature color mapping
      const tempColors = [
        {value: 0, color: '#000000', name: 'Black'},
        {value: 1, color: '#0000ff', name: 'Blue'},
        {value: 2, color: '#87ceeb', name: 'Sky Blue'},
        {value: 3, color: '#00ffff', name: 'Aqua'},
        {value: 4, color: '#808080', name: 'Medium'},
        {value: 5, color: '#ffff00', name: 'Yellow'},
        {value: 6, color: '#ffa500', name: 'Orange'},
        {value: 7, color: '#ff0000', name: 'Red'},
        {value: 8, color: '#8b0000', name: 'Dark Red'},
      ]

      // Get temperature color with interpolation for decimals
      function getTemperatureColor(temp) {
        temp = Math.max(0, Math.min(8, temp))

        const lowerIndex = Math.floor(temp)
        const upperIndex = Math.ceil(temp)

        if (lowerIndex === upperIndex) {
          return tempColors[lowerIndex].color
        }

        const fraction = temp - lowerIndex
        const lowerColor = tempColors[lowerIndex].color
        const upperColor = tempColors[upperIndex].color

        return interpolateColor(lowerColor, upperColor, fraction)
      }

      function interpolateColor(color1, color2, fraction) {
        const r1 = parseInt(color1.slice(1, 3), 16)
        const g1 = parseInt(color1.slice(3, 5), 16)
        const b1 = parseInt(color1.slice(5, 7), 16)

        const r2 = parseInt(color2.slice(1, 3), 16)
        const g2 = parseInt(color2.slice(3, 5), 16)
        const b2 = parseInt(color2.slice(5, 7), 16)

        const r = Math.round(r1 + (r2 - r1) * fraction)
        const g = Math.round(g1 + (g2 - g1) * fraction)
        const b = Math.round(b1 + (b2 - b1) * fraction)

        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`
      }

      // Get AQI color based on US AQI standards
      function getAQIColor(aqi) {
        if (aqi <= 50) return '#00e400' // Good - Green
        if (aqi <= 100) return '#ffff00' // Moderate - Yellow
        if (aqi <= 150) return '#ff7e00' // Unhealthy for Sensitive - Orange
        if (aqi <= 200) return '#ff0000' // Unhealthy - Red
        if (aqi <= 300) return '#8f3f97' // Very Unhealthy - Purple
        return '#7e0023' // Hazardous - Maroon
      }

      function getAQICategory(aqi) {
        if (aqi <= 50) return 'Good'
        if (aqi <= 100) return 'Moderate'
        if (aqi <= 150) return 'Unhealthy for Sensitive'
        if (aqi <= 200) return 'Unhealthy'
        if (aqi <= 300) return 'Very Unhealthy'
        return 'Hazardous'
      }

      // Cities storage
      let cities = []

      // Add city functionality
      document.getElementById('addCityBtn').addEventListener('click', () => {
        const name = document.getElementById('cityName').value.trim()
        const temp = parseFloat(document.getElementById('temperature').value)
        const aqi = parseInt(document.getElementById('airQuality').value)

        if (!name || isNaN(temp) || isNaN(aqi)) {
          alert('Please fill in all fields with valid values')
          return
        }

        if (temp < 0 || temp > 8) {
          alert('Temperature must be between 0 and 8')
          return
        }

        if (aqi < 1 || aqi > 500) {
          alert('Air Quality Index must be between 1 and 500')
          return
        }

        cities.push({name, temp, aqi})
        renderCities()

        // Clear inputs
        document.getElementById('cityName').value = ''
        document.getElementById('temperature').value = ''
        document.getElementById('airQuality').value = ''
      })

      function renderCities() {
        const container = document.getElementById('citiesDisplay')
        container.innerHTML = cities
          .map(city => {
            const tempColor = getTemperatureColor(city.temp)
            const aqiColor = getAQIColor(city.aqi)
            const aqiWidth = (city.aqi / 500) * 100

            return `
                    <div class="city-card">
                        <div class="city-name">${city.name}</div>
                        <div class="temperature-bar" style="background: ${tempColor};">
                            Temp: ${city.temp.toFixed(1)}
                        </div>
                        <div class="aqi-display">
                            <div style="font-weight: 600; margin-bottom: 5px;">
                                AQI: ${city.aqi} - ${getAQICategory(city.aqi)}
                            </div>
                            <div class="aqi-bar-container">
                                <div class="aqi-bar" style="width: ${aqiWidth}%; background: ${aqiColor};">
                                    ${city.aqi}
                                </div>
                            </div>
                        </div>
                    </div>
                `
          })
          .join('')
      }

      // Temperature tracking
      document.getElementById('trackingValue').addEventListener('input', e => {
        const value = parseInt(e.target.value)
        const marker = document.getElementById('tempMarker')
        marker.style.left = `${value}%`
        marker.setAttribute('data-value', `${value}%`)
      })

      // Video timeline
      let videoDuration = 60
      let currentTime = 0
      let isPlaying = false
      let animationId = null

      document.getElementById('videoDuration').addEventListener('change', e => {
        videoDuration = parseInt(e.target.value) || 60
        currentTime = 0
        updateVideoDisplay()
      })

      document.getElementById('playBtn').addEventListener('click', () => {
        if (!isPlaying) {
          isPlaying = true
          playVideo()
        }
      })

      document.getElementById('pauseBtn').addEventListener('click', () => {
        isPlaying = false
        if (animationId) {
          cancelAnimationFrame(animationId)
        }
      })

      document.getElementById('resetBtn').addEventListener('click', () => {
        isPlaying = false
        if (animationId) {
          cancelAnimationFrame(animationId)
        }
        currentTime = 0
        updateVideoDisplay()
      })

      function playVideo() {
        if (!isPlaying) return

        currentTime += 0.016 // ~60fps
        if (currentTime >= videoDuration) {
          currentTime = videoDuration
          isPlaying = false
        }

        updateVideoDisplay()

        if (isPlaying) {
          animationId = requestAnimationFrame(playVideo)
        }
      }

      function updateVideoDisplay() {
        const progress = (currentTime / videoDuration) * 100
        document.getElementById('videoProgress').style.width = `${progress}%`

        const currentMins = Math.floor(currentTime / 60)
        const currentSecs = Math.floor(currentTime % 60)
        const totalMins = Math.floor(videoDuration / 60)
        const totalSecs = Math.floor(videoDuration % 60)

        document.getElementById('videoTime').textContent =
          `${currentMins}:${currentSecs.toString().padStart(2, '0')} / ${totalMins}:${totalSecs.toString().padStart(2, '0')}`
      }

      // Initialize
      updateVideoDisplay()

      // Reset All button
      document.getElementById('resetAllBtn').addEventListener('click', () => {
        location.reload()
      })
    </script>
  </body>
</html>
